---
name: E2E Login and Admin Panel Tests
status: open
created: 2026-02-02T10:02:04Z
updated: 2026-02-02T10:02:04Z
github:
depends_on: [006]
parallel: true
conflicts_with: []
---

# Task 007: E2E Login and Admin Panel Tests

## Description

Create end-to-end tests for the login page branding and admin panel functionality using Playwright. These tests verify that custom branding is correctly applied to the authentication flow and that administrators can successfully configure and apply rebrand settings through the UI.

## Acceptance Criteria

- [ ] Login page tests verify custom logo display at `/auth/authorize`
- [ ] Login page tests verify primary color application
- [ ] Login page tests verify custom title display
- [ ] Admin panel tests can navigate to Rebrand configuration panel
- [ ] Admin panel tests can upload a custom logo
- [ ] Admin panel tests can configure branding settings
- [ ] Admin panel tests can apply changes and verify they take effect
- [ ] All tests pass consistently in both headed and headless modes
- [ ] Tests include proper error handling and meaningful assertions

## Technical Details

### Login Page Tests (`tests/e2e/test_login_branding.py`)

```python
# Test scenarios:
# 1. Navigate to /auth/authorize
# 2. Verify custom logo is displayed (check img src or background)
# 3. Verify primary color is applied to buttons/links
# 4. Verify custom title in page title or header
# 5. Test with default branding vs custom branding
```

### Admin Panel Tests (`tests/e2e/test_admin_panel.py`)

```python
# Test scenarios:
# 1. Login as admin user
# 2. Navigate to Configuration > Integrations > Rebrand Manager
# 3. Access the Rebrand panel
# 4. Upload custom logo file
# 5. Configure primary color, title, and other settings
# 6. Save/apply changes
# 7. Verify changes are persisted
# 8. Verify changes apply to frontend
```

### Page Object Pattern

```python
# pages/login_page.py
class LoginPage:
    def __init__(self, page):
        self.page = page

    async def navigate(self):
        await self.page.goto("/auth/authorize")

    async def get_logo_src(self):
        logo = await self.page.query_selector("[data-testid='logo']")
        return await logo.get_attribute("src")

    async def get_primary_color(self):
        # Extract computed style from primary elements
        pass

# pages/admin_panel.py
class AdminPanel:
    def __init__(self, page):
        self.page = page

    async def navigate_to_rebrand(self):
        await self.page.click("[data-panel='config']")
        await self.page.click("text=Rebrand Manager")

    async def upload_logo(self, file_path):
        await self.page.set_input_files("input[type='file']", file_path)

    async def apply_settings(self):
        await self.page.click("[data-testid='apply-button']")
```

### Test Fixtures

```python
@pytest.fixture
async def authenticated_page(page, ha_instance):
    """Login and return authenticated page."""
    await page.goto(f"{ha_instance}/auth/authorize")
    await page.fill("#username", "admin")
    await page.fill("#password", "admin")
    await page.click("button[type='submit']")
    await page.wait_for_url("**/lovelace/**")
    return page

@pytest.fixture
def sample_logo(tmp_path):
    """Create a sample logo for upload tests."""
    logo_path = tmp_path / "test_logo.png"
    # Create minimal valid PNG
    return logo_path
```

### Selectors Strategy

- Prefer data-testid attributes when available
- Fall back to role-based selectors (getByRole)
- Use text selectors for buttons and links
- Avoid CSS class selectors that may change

## Dependencies

- **Task 006**: Test fixtures and utilities must be in place
- Playwright and pytest-playwright installed
- Running Home Assistant test instance with rebrand integration

## Effort Estimate

- **Estimated Hours**: 6-8 hours
- **Complexity**: Medium-High
- **Risk**: Medium (depends on HA UI stability)

## Definition of Done

1. All login page branding tests implemented and passing
2. All admin panel configuration tests implemented and passing
3. Page objects created for reusable test components
4. Tests documented with clear descriptions
5. Tests run in under 60 seconds total
6. Screenshots captured on failure for debugging
7. No flaky tests (all pass 10 consecutive runs)
8. Code reviewed and merged to test branch
